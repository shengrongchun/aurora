(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2572e239"],{"070d":function(t,e,a){},"121b":function(t,e,a){"use strict";var s=a("4b6e"),n=a.n(s);n.a},"1afa":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"panel"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("el-page-header",{on:{back:t.goBack}},[a("div",{staticClass:"content",attrs:{slot:"content"},slot:"content"},[a("i",{staticClass:"iconfont icon-yibiaopan"}),a("el-input",{attrs:{placeholder:"未命名"},model:{value:t.form.compName,callback:function(e){t.$set(t.form,"compName",e)},expression:"form.compName"}})],1)])],1),a("div",{staticClass:"right"},[t.$store.state.panel.preView?t._e():[a("span",{staticClass:"theme"},[t._v("主题")]),a("el-select",{staticClass:"dark",attrs:{"popper-append-to-body":!1},model:{value:t.$store.state.panel.theme,callback:function(e){t.$set(t.$store.state.panel,"theme",e)},expression:"$store.state.panel.theme"}},[a("el-option",{attrs:{value:"default",label:"默认"}}),a("el-option",{attrs:{value:"dark",label:"黑暗"}})],1)],a("el-radio-group",{attrs:{size:"mini"},model:{value:t.$store.state.panel.preView,callback:function(e){t.$set(t.$store.state.panel,"preView",e)},expression:"$store.state.panel.preView"}},[a("el-radio-button",{attrs:{label:!1}},[t._v("编辑")]),a("el-radio-button",{attrs:{label:!0}},[t._v("预览")])],1),a("span",{staticClass:"span-btn",on:{click:t.openDialog}},[t._v("保存&权限设置")])],2)]),t.authorityVisible?a("AuthorityDialog",{attrs:{visible:t.authorityVisible,list:t.compAuList},on:{close:function(e){t.authorityVisible=!1}}}):t._e(),a("Main",{style:{height:"calc(100% - 40px)"}})],1)},n=[],i=(a("ac6a"),a("456d"),a("7f7f"),a("c5f6"),a("c7ca")),o=a("caf0"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:"数据权限设置",visible:t.visible,"close-on-click-modal":!1,"before-close":function(){t.$emit("close")},width:"50%"},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"数据权限控制"}},[a("el-switch",{staticStyle:{"margin-left":"10px"},model:{value:t.form.authOpen,callback:function(e){t.$set(t.form,"authOpen",e)},expression:"form.authOpen"}})],1),t.form.authOpen?[a("el-form-item",{attrs:{label:"单车城市权限"}},[a("el-select",{attrs:{placeholder:"单车城市权限"},model:{value:t.form.cityAuthType,callback:function(e){t.$set(t.form,"cityAuthType",e)},expression:"form.cityAuthType"}},t._l(t.controlTypes,function(e){return a("el-option",{key:e,attrs:{label:t.controlTypes[e],value:e}})}),1)],1),a("el-form-item",{attrs:{label:"权限控制情况"}},[a("span",{staticClass:"noticeText"},[t._v(t._s(t.controller.cLength)+"个组件可以控制住数据权限 ; "+t._s(t.controller.nCLength)+"个组件不能控制，可选择修改或忽略")])])]:t._e()],2),t.form.authOpen?a("el-table",{attrs:{data:t.form.compAuths}},[a("el-table-column",{attrs:{label:"组件名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{style:"不控制"===e.row.authType?"color:red":""},[t._v("\n          "+t._s(e.row.compName))])]}}],null,!1,283134351)}),a("el-table-column",{attrs:{label:"权限控制粒度"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-dropdown",{model:{value:e.row.authType,callback:function(a){t.$set(e.row,"authType",a)},expression:"scope.row.authType"}},[a("span",{staticClass:"el-dropdown-link"},[a("span",{style:"不控制"===e.row.authType?"color:red":""},[t._v("\n              "+t._s(e.row.authType||"请选择"))]),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(t){e.row.authType="不控制"}}},[t._v("\n              不控制")]),a("el-dropdown-item",{nativeOn:{click:function(t){e.row.authType="城市"}}},[t._v("\n              城市")]),a("el-dropdown-item",{nativeOn:{click:function(t){e.row.authType="省区"}}},[t._v("\n              省区")]),a("el-dropdown-item",{nativeOn:{click:function(t){e.row.authType="大区"}}},[t._v("\n              大区")])],1)],1)]}}],null,!1,667562894)}),a("el-table-column",{attrs:{label:"权限控制字段"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{disabled:"不控制"===e.row.authType,filterable:"",placeholder:"请选择"},model:{value:e.row.authCol,callback:function(a){t.$set(e.row,"authCol",a)},expression:"scope.row.authCol"}},t._l(e.row.controlFieldList,function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}),1)]}}],null,!1,3692260649)})],1):t._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){return t.$emit("close")}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保 存")])],1)],1)},l=[],c=(a("96cf"),a("3b8d")),u=a("b122"),p={props:{visible:{type:Boolean,default:!1},list:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,dialogVisible:!1,controlTypes:{},form:{dashboardId:null,authOpen:!1,cityAuthType:null,compAuths:[]}}},computed:{controller:function(){var t=this.form.compAuths.filter(function(t){return"不控制"!==t.authType}).length;return{cLength:t,nCLength:this.form.compAuths.length-t}}},created:function(){this.getCityAuList(),this.getOldData()},methods:{queryXyOnline:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e,a){var s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(o["f"])(e);case 2:s=t.sent,this.form.compAuths[a].controlFieldList=s||[];case 4:case"end":return t.stop()}},t,this)}));function e(e,a){return t.apply(this,arguments)}return e}(),getCityAuList:function(){var t=this;Object(u["u"])(-1).then(function(e){t.controlTypes=e.cityAuthType})},setTableList:function(){var t=this;this.list.forEach(function(e,a){var s=e.compId,n=e.compName,i=e.dataSetId,o=e.dataSetName,r=e.dataSetType;t.form.compAuths.push({compId:s,compName:n,authType:t.mapList[s]?t.mapList[s].authType:null,authCol:t.mapList[s]?t.mapList[s].authCol:null,controlFieldList:[]}),t.queryXyOnline({dataSetId:i,dataSetName:o,dataSetType:r},a)})},getOldData:function(){var t=this;this.mapList={},"create"!==this.$route.params.id?Object(u["t"])(this.$route.params.id).then(function(e){var a=e.dashboardId,s=e.authOpen,n=e.cityAuthType,i=e.compAuths;(i||[]).forEach(function(e){t.mapList[e.compId]=e}),t.form={dashboardId:a,authOpen:1===s,cityAuthType:n,compAuths:[]},t.setTableList()}).catch(function(){}):this.setTableList()},save:function(){var t=this;if(this.form.authOpen){if(!this.form.cityAuthType)return void this.$message({type:"warning",message:"请选择单车城市权限"});for(var e=0;e<this.form.compAuths.length;e+=1){var a=this.form.compAuths[e],s=a.authType,n=a.authCol;if(!s)return void this.$message({type:"warning",message:"请选择粒度字段"});if("不控制"!==s&&!n)return void this.$message({type:"warning",message:"请选择城市控制字段"})}}var i=this.$parent.save();i.then(function(e){t.$route.params.id=e;var a={dashboardId:e,authOpen:!0===t.form.authOpen?1:0,cityAuthType:t.form.cityAuthType,compAuths:t.form.compAuths.map(function(t){var e=t.authCol,a=t.authType,s=t.compId,n=t.compName;return{authCol:e,authType:a,compId:s,compName:n}})};t.loading=!0,Object(u["x"])(a).then(function(){t.$message({type:"success",message:"数据权限保存成功"}),t.$emit("close")}).finally(function(){t.loading=!0})}).catch(function(){})}}},m=p,d=(a("638e"),a("2877")),h=Object(d["a"])(m,r,l,!1,null,"6d397d8f",null),f=h.exports,y={components:{Main:i["a"],AuthorityDialog:f},props:{projectId:{type:[String,Number],default:null},parentId:{type:[String,Number],default:null},id:{type:[String,Number],default:null},breadList:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,authorityVisible:!1,form:{compName:null},compAuList:[]}},created:function(){this.Id=this.id;var t=this.$store.state.panel.compList;"create"!==this.Id?this.getData():0===t.length&&this.$store.commit("addComp",{type:"Line",x:0,y:0,list:t,compType:null,vm:this})},methods:{getData:function(){var t=this;this.loading=!0,Object(o["a"])(this.Id).then(function(e){t.form.compName=e.name;var a=JSON.parse(e.config);t.$store.commit("setCompList",a)}).finally(function(){t.loading=!1})},setCompAuList:function(t){for(var e=this,a=0;a<t.length;a+=1)if("Tab"!==t[a].type&&"Search"!==t[a].type){if(!(Object.keys(t[a].params).length>0))return void(this.noParams=!0);var s=t[a],n=s.i,i=s.params,o=s.styles,r=i.dataSetId,l=i.dataSetName,c=i.dataSetType;this.compAuList.push({compId:n,compName:o.label.text,dataSetId:r,dataSetName:l,dataSetType:c})}else"Tab"===t[a].type&&t[a].styles.tabList.forEach(function(t){e.setCompAuList(t.compList||[])})},openDialog:function(){this.form.compName?this.$store.state.panel.compList.length?(this.compAuList=[],this.noParams=!1,this.setCompAuList(this.$store.state.panel.compList),this.noParams?this.$message({type:"warning",message:"有组件未配置"}):this.authorityVisible=!0):this.$message({type:"warning",message:"请拖组件"}):this.$message({type:"warning",message:"请输入仪表板名称"})},save:function(){var t=this;return new Promise(function(e,a){Object(o["g"])({id:"create"===t.Id?null:t.Id,projectId:t.projectId,directoryId:t.parentId,name:t.form.compName,config:JSON.stringify({compList:t.$store.state.panel.compList,labelMap:t.$store.state.panel.labelMap,theme:t.$store.state.panel.theme})}).then(function(a){t.Id=a,t.$message({type:"success",message:"面板保存成功"}),e(a)}).finally(function(){a()})})},goBack:function(){this.$router.push({name:"createSpaceIndex",params:{parentId:this.parentId,projectId:this.projectId,breadList:JSON.stringify(this.breadList)}})}}},b=y,g=(a("121b"),Object(d["a"])(b,s,n,!1,null,"edd0993a",null));e["default"]=g.exports},2164:function(t,e,a){},"4b6e":function(t,e,a){},"638e":function(t,e,a){"use strict";var s=a("2164"),n=a.n(s);n.a},"7b5f":function(t,e,a){"use strict";var s=a("070d"),n=a.n(s);n.a},"91a5":function(t,e,a){"use strict";var s=a("facd"),n=a.n(s);n.a},c7ca:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:["main",t.$store.state.panel.theme]},[t.$store.state.panel.preView?a("drag-container",{attrs:{list:t.$store.state.panel.compList}}):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.$store.state.panel.preView,expression:"!$store.state.panel.preView"}],staticClass:"main-flex"},[a("div",{staticClass:"left-container"},[a("drag-header"),a("drag-container",{attrs:{list:t.$store.state.panel.compList}})],1),t.$store.state.panel.compList.length>0&&t.activeObj.type?a("div",{staticClass:"right-container"},[a(t.activeObj.type+"Config",{key:t.activeObj.i,tag:"component",attrs:{data:t.activeObj}})],1):t._e()])],1)},n=[],i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"left-header"},[a("ul",{staticClass:"utils"},t._l(t.utilsCList,function(e,s){return a("li",{key:s,attrs:{title:e.name,type:e.icon,draggable:"true"},on:{dblclick:function(a){return t.dbclick(e)},dragstart:function(e){return e.stopPropagation(),t.dragstart(e)}}},[a("i",{class:"iconfont icon-"+e.icon})])}),0),a("div",{staticClass:"silder"}),a("ul",t._l(t.compCList,function(e,s){return a("li",{key:s,attrs:{title:e.name,type:e.icon,draggable:"true"},on:{dblclick:function(a){return t.dbclick(e)},dragstart:function(e){return e.stopPropagation(),t.dragstart(e)}}},[a("i",{class:"iconfont icon-"+e.icon})])}),0)])},o=[],r=(a("6762"),a("2fdb"),a("27cc")),l={created:function(){this.utilsCList=r["f"],this.compCList=r["a"]},methods:{dbclick:function(t){["Select","Date"].includes(t.icon)||this.$store.commit("addComp",{type:t.icon,x:0,y:0,list:this.$store.state.panel.compList,compType:null,vm:this})},dragstart:function(t){t.dataTransfer.setData("type",t.target.type)}}},c=l,u=(a("91a5"),a("2877")),p=Object(u["a"])(c,i,o,!1,null,"772408f4",null),m=p.exports,d=a("40ee"),h={components:{dragHeader:m,dragContainer:d["a"]},computed:{activeObj:function(){return this.$store.state.panel.activeComp}},watch:{activeObj:function(){this.compChange=!0},"activeObj.styles.label.text":function(t,e){if(this.compChange)delete this.compChange;else{if(!t)return this.$message({type:"warning",message:"组件标题必填"}),this.activeObj.styles.label.text=e,void(this.compChange=!0);if(this.$store.state.panel.labelMap[t])return this.$message({type:"warning",message:"组件标题重复"}),this.activeObj.styles.label.text=e,void(this.compChange=!0);delete this.$store.state.panel.labelMap[e],this.$store.state.panel.labelMap[t]=!0}}}},f=h,y=(a("7b5f"),Object(u["a"])(f,s,n,!1,null,"7b95582e",null));e["a"]=y.exports},facd:function(t,e,a){}}]);
//# sourceMappingURL=chunk-2572e239.e9e21e5b.js.map